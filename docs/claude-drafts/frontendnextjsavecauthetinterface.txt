Je vais cr√©er le frontend complet de Skybot Inbox avec Next.js 14 et l'App Router. Commen√ßons par les fichiers utilitaires puis progressons vers les composants d'interface.

---

## 1. Fichiers utilitaires

### `frontend/lib/apiClient.ts`

```typescript
// frontend/lib/apiClient.ts

const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000/api';

// Gestion du token JWT dans localStorage
export const tokenStorage = {
  setToken: (token: string) => {
    if (typeof window !== 'undefined') {
      localStorage.setItem('skybot_token', token);
    }
  },
  
  getToken: (): string | null => {
    if (typeof window !== 'undefined') {
      return localStorage.getItem('skybot_token');
    }
    return null;
  },
  
  removeToken: () => {
    if (typeof window !== 'undefined') {
      localStorage.removeItem('skybot_token');
    }
  }
};

// Types pour les r√©ponses API
interface ApiResponse<T = any> {
  data?: T;
  error?: string;
  message?: string;
}

// Options de requ√™te
interface RequestOptions {
  body?: any;
  headers?: Record<string, string>;
}

// Wrapper pour les appels API
class ApiClient {
  private getHeaders(customHeaders?: Record<string, string>): HeadersInit {
    const headers: HeadersInit = {
      'Content-Type': 'application/json',
      ...customHeaders,
    };

    const token = tokenStorage.getToken();
    if (token) {
      headers['Authorization'] = `Bearer ${token}`;
    }

    return headers;
  }

  private async handleResponse<T>(response: Response): Promise<T> {
    // Si 401, on d√©connecte l'utilisateur
    if (response.status === 401) {
      tokenStorage.removeToken();
      if (typeof window !== 'undefined') {
        window.location.href = '/login';
      }
      throw new Error('Non autoris√©');
    }

    // Si erreur HTTP
    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      throw new Error(errorData.message || `Erreur ${response.status}`);
    }

    // Retour JSON
    return response.json();
  }

  async get<T = any>(endpoint: string, options?: RequestOptions): Promise<T> {
    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
      method: 'GET',
      headers: this.getHeaders(options?.headers),
    });

    return this.handleResponse<T>(response);
  }

  async post<T = any>(endpoint: string, body?: any, options?: RequestOptions): Promise<T> {
    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
      method: 'POST',
      headers: this.getHeaders(options?.headers),
      body: JSON.stringify(body),
    });

    return this.handleResponse<T>(response);
  }

  async put<T = any>(endpoint: string, body?: any, options?: RequestOptions): Promise<T> {
    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
      method: 'PUT',
      headers: this.getHeaders(options?.headers),
      body: JSON.stringify(body),
    });

    return this.handleResponse<T>(response);
  }

  async delete<T = any>(endpoint: string, options?: RequestOptions): Promise<T> {
    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
      method: 'DELETE',
      headers: this.getHeaders(options?.headers),
    });

    return this.handleResponse<T>(response);
  }
}

export const apiClient = new ApiClient();
```

---

### `frontend/lib/queryClient.ts`

```typescript
// frontend/lib/queryClient.ts

import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      refetchOnWindowFocus: true,
      refetchOnMount: true,
      refetchOnReconnect: true,
      retry: 1,
      staleTime: 5000, // 5 secondes
    },
    mutations: {
      retry: 1,
    },
  },
});
```

---

### `frontend/lib/types.ts`

```typescript
// frontend/lib/types.ts

// Enums
export enum ConversationStatus {
  OPEN = 'OPEN',
  RESOLVED = 'RESOLVED',
  PENDING = 'PENDING',
  SNOOZED = 'SNOOZED'
}

export enum MessageType {
  INCOMING = 'INCOMING',
  OUTGOING = 'OUTGOING'
}

export enum SenderType {
  CONTACT = 'CONTACT',
  AGENT = 'AGENT',
  BOT = 'BOT'
}

// Interfaces principales
export interface User {
  id: string;
  accountId: string;
  name: string;
  email: string;
  createdAt: string;
  updatedAt: string;
}

export interface Account {
  id: string;
  name: string;
  createdAt: string;
  updatedAt: string;
}

export interface Inbox {
  id: string;
  accountId: string;
  name: string;
  channelType: string;
  channelConfig: Record<string, any>;
  createdAt: string;
  updatedAt: string;
}

export interface Contact {
  id: string;
  accountId: string;
  name?: string;
  phoneNumber?: string;
  email?: string;
  metadata?: Record<string, any>;
  createdAt: string;
  updatedAt: string;
}

export interface Conversation {
  id: string;
  inboxId: string;
  contactId: string;
  status: ConversationStatus;
  assignedUserId?: string;
  metadata?: Record<string, any>;
  lastActivityAt: string;
  createdAt: string;
  updatedAt: string;
  contact?: Contact;
  assignedUser?: User;
  unreadCount?: number;
}

export interface Message {
  id: string;
  conversationId: string;
  content: string;
  messageType: MessageType;
  senderType: SenderType;
  senderId?: string;
  externalId?: string;
  metadata?: Record<string, any>;
  createdAt: string;
  updatedAt: string;
}

// Types de r√©ponse API
export interface LoginResponse {
  accessToken: string;
  user: User;
}

export interface RegisterResponse {
  accessToken: string;
  user: User;
}
```

---

## 2. Layout global

### `frontend/app/layout.tsx`

```typescript
// frontend/app/layout.tsx

import type { Metadata } from 'next';
import { Inter } from 'next/font/google';
import './globals.css';
import { Providers } from './providers';

const inter = Inter({ subsets: ['latin'] });

export const metadata: Metadata = {
  title: 'Skybot Inbox',
  description: 'Inbox omnicanale pour Skybot',
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="fr">
      <body className={inter.className}>
        <Providers>
          {children}
        </Providers>
      </body>
    </html>
  );
}
```

---

### `frontend/app/providers.tsx`

```typescript
// frontend/app/providers.tsx

'use client';

import { QueryClientProvider } from '@tanstack/react-query';
import { queryClient } from '@/lib/queryClient';

export function Providers({ children }: { children: React.ReactNode }) {
  return (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  );
}
```

---

### `frontend/app/globals.css`

```css
/* frontend/app/globals.css */

@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --background: #f9fafb;
  --foreground: #111827;
}

body {
  color: var(--foreground);
  background: var(--background);
  font-family: system-ui, -apple-system, sans-serif;
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }
}
```

---

## 3. Pages d'authentification

### `frontend/app/(auth)/login/page.tsx`

```typescript
// frontend/app/(auth)/login/page.tsx

'use client';

import { useState, FormEvent } from 'react';
import { useRouter } from 'next/navigation';
import { apiClient, tokenStorage } from '@/lib/apiClient';
import { LoginResponse } from '@/lib/types';

export default function LoginPage() {
  const router = useRouter();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault();
    setError('');
    setLoading(true);

    try {
      const response = await apiClient.post<LoginResponse>('/auth/login', {
        email,
        password,
      });

      tokenStorage.setToken(response.accessToken);
      router.push('/dashboard');
    } catch (err: any) {
      setError(err.message || 'Erreur de connexion');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 px-4">
      <div className="max-w-md w-full space-y-8">
        <div>
          <h2 className="text-center text-3xl font-bold text-gray-900">
            Skybot Inbox
          </h2>
          <p className="mt-2 text-center text-sm text-gray-600">
            Connectez-vous √† votre compte
          </p>
        </div>

        <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
          {error && (
            <div className="rounded-md bg-red-50 p-4">
              <p className="text-sm text-red-800">{error}</p>
            </div>
          )}

          <div className="rounded-md shadow-sm space-y-4">
            <div>
              <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-1">
                Email
              </label>
              <input
                id="email"
                name="email"
                type="email"
                autoComplete="email"
                required
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className="appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                placeholder="vous@exemple.com"
              />
            </div>

            <div>
              <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-1">
                Mot de passe
              </label>
              <input
                id="password"
                name="password"
                type="password"
                autoComplete="current-password"
                required
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                className="appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              />
            </div>
          </div>

          <div>
            <button
              type="submit"
              disabled={loading}
              className="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {loading ? 'Connexion...' : 'Se connecter'}
            </button>
          </div>

          <div className="text-center">
            <a href="/register" className="text-sm text-blue-600 hover:text-blue-500">
              Pas encore de compte ? S'inscrire
            </a>
          </div>
        </form>
      </div>
    </div>
  );
}
```

---

### `frontend/app/(auth)/register/page.tsx`

```typescript
// frontend/app/(auth)/register/page.tsx

'use client';

import { useState, FormEvent } from 'react';
import { useRouter } from 'next/navigation';
import { apiClient, tokenStorage } from '@/lib/apiClient';
import { RegisterResponse } from '@/lib/types';

export default function RegisterPage() {
  const router = useRouter();
  const [accountName, setAccountName] = useState('');
  const [name, setName] = useState('');
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault();
    setError('');
    setLoading(true);

    try {
      const response = await apiClient.post<RegisterResponse>('/auth/register', {
        accountName,
        name,
        email,
        password,
      });

      tokenStorage.setToken(response.accessToken);
      router.push('/dashboard');
    } catch (err: any) {
      setError(err.message || 'Erreur lors de l\'inscription');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 px-4">
      <div className="max-w-md w-full space-y-8">
        <div>
          <h2 className="text-center text-3xl font-bold text-gray-900">
            Skybot Inbox
          </h2>
          <p className="mt-2 text-center text-sm text-gray-600">
            Cr√©ez votre compte
          </p>
        </div>

        <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
          {error && (
            <div className="rounded-md bg-red-50 p-4">
              <p className="text-sm text-red-800">{error}</p>
            </div>
          )}

          <div className="rounded-md shadow-sm space-y-4">
            <div>
              <label htmlFor="accountName" className="block text-sm font-medium text-gray-700 mb-1">
                Nom de l'entreprise
              </label>
              <input
                id="accountName"
                name="accountName"
                type="text"
                required
                value={accountName}
                onChange={(e) => setAccountName(e.target.value)}
                className="appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="Mon Entreprise"
              />
            </div>

            <div>
              <label htmlFor="name" className="block text-sm font-medium text-gray-700 mb-1">
                Votre nom
              </label>
              <input
                id="name"
                name="name"
                type="text"
                required
                value={name}
                onChange={(e) => setName(e.target.value)}
                className="appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="Jean Dupont"
              />
            </div>

            <div>
              <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-1">
                Email
              </label>
              <input
                id="email"
                name="email"
                type="email"
                autoComplete="email"
                required
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className="appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="vous@exemple.com"
              />
            </div>

            <div>
              <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-1">
                Mot de passe
              </label>
              <input
                id="password"
                name="password"
                type="password"
                autoComplete="new-password"
                required
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                className="appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              />
            </div>
          </div>

          <div>
            <button
              type="submit"
              disabled={loading}
              className="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {loading ? 'Cr√©ation...' : 'Cr√©er mon compte'}
            </button>
          </div>

          <div className="text-center">
            <a href="/login" className="text-sm text-blue-600 hover:text-blue-500">
              D√©j√† un compte ? Se connecter
            </a>
          </div>
        </form>
      </div>
    </div>
  );
}
```

---

## 4. Layout App

### `frontend/components/layout/AppShell.tsx`

```typescript
// frontend/components/layout/AppShell.tsx

'use client';

import { useRouter } from 'next/navigation';
import { tokenStorage } from '@/lib/apiClient';

interface AppShellProps {
  children: React.ReactNode;
  sidebar?: React.ReactNode;
}

export function AppShell({ children, sidebar }: AppShellProps) {
  const router = useRouter();

  const handleLogout = () => {
    tokenStorage.removeToken();
    router.push('/login');
  };

  return (
    <div className="h-screen flex flex-col">
      {/* Header */}
      <header className="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
        <h1 className="text-xl font-bold text-gray-900">Skybot Inbox</h1>
        <button
          onClick={handleLogout}
          className="px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors"
        >
          D√©connexion
        </button>
      </header>

      {/* Main content */}
      <div className="flex-1 flex overflow-hidden">
        {/* Sidebar optionnelle */}
        {sidebar && (
          <aside className="w-64 bg-white border-r border-gray-200 overflow-y-auto">
            {sidebar}
          </aside>
        )}

        {/* Contenu principal */}
        <main className="flex-1 overflow-hidden bg-gray-50">
          {children}
        </main>
      </div>
    </div>
  );
}
```

---

## 5. Composants Inbox

### `frontend/components/inbox/InboxSidebar.tsx`

```typescript
// frontend/components/inbox/InboxSidebar.tsx

'use client';

import { useQuery } from '@tanstack/react-query';
import { apiClient } from '@/lib/apiClient';
import { Inbox } from '@/lib/types';

export function InboxSidebar() {
  const { data: inboxes, isLoading, error } = useQuery({
    queryKey: ['inboxes'],
    queryFn: () => apiClient.get<Inbox[]>('/inboxes'),
  });

  if (isLoading) {
    return (
      <div className="p-4">
        <p className="text-sm text-gray-500">Chargement...</p>
      </div>
    );
  }

  if (error) {
    return (
      <div className="p-4">
        <p className="text-sm text-red-600">Erreur de chargement</p>
      </div>
    );
  }

  return (
    <div className="p-4">
      <h2 className="text-lg font-semibold text-gray-900 mb-4">Inboxes</h2>
      <div className="space-y-2">
        {inboxes?.map((inbox) => (
          <div
            key={inbox.id}
            className="p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors"
          >
            <div className="font-medium text-sm text-gray-900">
              {inbox.name}
            </div>
            <div className="text-xs text-gray-500 mt-1">
              {inbox.channelType}
            </div>
          </div>
        ))}
        {(!inboxes || inboxes.length === 0) && (
          <p className="text-sm text-gray-500">Aucune inbox</p>
        )}
      </div>
    </div>
  );
}
```

---

### `frontend/components/inbox/ConversationItem.tsx`

```typescript
// frontend/components/inbox/ConversationItem.tsx

'use client';

import { Conversation } from '@/lib/types';

interface ConversationItemProps {
  conversation: Conversation;
  isSelected: boolean;
  onClick: () => void;
}

export function ConversationItem({ conversation, isSelected, onClick }: ConversationItemProps) {
  const displayName = conversation.contact?.name || 
                     conversation.contact?.phoneNumber || 
                     conversation.contact?.email || 
                     'Contact inconnu';

  const lastActivityDate = new Date(conversation.lastActivityAt);
  const now = new Date();
  const diffMs = now.getTime() - lastActivityDate.getTime();
  const diffMins = Math.floor(diffMs / 60000);
  
  let timeDisplay = '';
  if (diffMins < 1) {
    timeDisplay = '√Ä l\'instant';
  } else if (diffMins < 60) {
    timeDisplay = `Il y a ${diffMins}min`;
  } else if (diffMins < 1440) {
    const hours = Math.floor(diffMins / 60);
    timeDisplay = `Il y a ${hours}h`;
  } else {
    timeDisplay = lastActivityDate.toLocaleDateString('fr-FR');
  }

  const statusColors = {
    OPEN: 'bg-green-100 text-green-800',
    RESOLVED: 'bg-gray-100 text-gray-800',
    PENDING: 'bg-yellow-100 text-yellow-800',
    SNOOZED: 'bg-blue-100 text-blue-800',
  };

  return (
    <div
      onClick={onClick}
      className={`
        p-4 cursor-pointer border-b border-gray-200 hover:bg-gray-50 transition-colors
        ${isSelected ? 'bg-blue-50 border-l-4 border-l-blue-600' : ''}
      `}
    >
      <div className="flex items-start justify-between mb-2">
        <div className="flex-1 min-w-0">
          <h3 className="font-semibold text-sm text-gray-900 truncate">
            {displayName}
          </h3>
          <p className="text-xs text-gray-500 mt-1">{timeDisplay}</p>
        </div>
        
        {conversation.unreadCount && conversation.unreadCount > 0 && (
          <span className="ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold text-white bg-blue-600 rounded-full">
            {conversation.unreadCount}
          </span>
        )}
      </div>

      <div className="flex items-center gap-2">
        <span className={`text-xs px-2 py-1 rounded-full ${statusColors[conversation.status]}`}>
          {conversation.status}
        </span>
      </div>
    </div>
  );
}
```

---

### `frontend/components/inbox/ConversationList.tsx`

```typescript
// frontend/components/inbox/ConversationList.tsx

'use client';

import { useQuery } from '@tanstack/react-query';
import { apiClient } from '@/lib/apiClient';
import { Conversation, ConversationStatus } from '@/lib/types';
import { ConversationItem } from './ConversationItem';

interface ConversationListProps {
  selectedConversationId?: string;
  onSelectConversation: (id: string) => void;
}

export function ConversationList({ selectedConversationId, onSelectConversation }: ConversationListProps) {
  const { data: conversations, isLoading, error } = useQuery({
    queryKey: ['conversations', ConversationStatus.OPEN],
    queryFn: () => apiClient.get<Conversation[]>(`/conversations?status=${ConversationStatus.OPEN}`),
    refetchInterval: 10000, // Refetch toutes les 10 secondes
  });

  if (isLoading) {
    return (
      <div className="flex items-center justify-center h-full">
        <p className="text-sm text-gray-500">Chargement des conversations...</p>
      </div>
    );
  }

  if (error) {
    return (
      <div className="flex items-center justify-center h-full">
        <p className="text-sm text-red-600">Erreur de chargement</p>
      </div>
    );
  }

  return (
    <div className="h-full flex flex-col bg-white">
      <div className="p-4 border-b border-gray-200">
        <h2 className="text-lg font-semibold text-gray-900">Conversations</h2>
        <p className="text-xs text-gray-500 mt-1">
          {conversations?.length || 0} conversation(s) ouverte(s)
        </p>
      </div>

      <div className="flex-1 overflow-y-auto">
        {conversations?.map((conversation) => (
          <ConversationItem
            key={conversation.id}
            conversation={conversation}
            isSelected={conversation.id === selectedConversationId}
            onClick={() => onSelectConversation(conversation.id)}
          />
        ))}
        {(!conversations || conversations.length === 0) && (
          <div className="flex items-center justify-center h-32">
            <p className="text-sm text-gray-500">Aucune conversation ouverte</p>
          </div>
        )}
      </div>
    </div>
  );
}
```

---

### `frontend/components/inbox/MessageList.tsx`

```typescript
// frontend/components/inbox/MessageList.tsx

'use client';

import { useEffect, useRef } from 'react';
import { useQuery } from '@tanstack/react-query';
import { apiClient } from '@/lib/apiClient';
import { Message, MessageType, SenderType } from '@/lib/types';

interface MessageListProps {
  conversationId: string;
}

export function MessageList({ conversationId }: MessageListProps) {
  const messagesEndRef = useRef<HTMLDivElement>(null);

  const { data: messages, isLoading, error } = useQuery({
    queryKey: ['messages', conversationId],
    queryFn: () => apiClient.get<Message[]>(`/conversations/${conversationId}/messages`),
    refetchInterval: 5000, // Refetch toutes les 5 secondes
    enabled: !!conversationId,
  });

  // Auto-scroll vers le bas quand de nouveaux messages arrivent
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  if (isLoading) {
    return (
      <div className="flex items-center justify-center h-full">
        <p className="text-sm text-gray-500">Chargement des messages...</p>
      </div>
    );
  }

  if (error) {
    return (
      <div className="flex items-center justify-center h-full">
        <p className="text-sm text-red-600">Erreur de chargement</p>
      </div>
    );
  }

  return (
    <div className="flex-1 overflow-y-auto p-4 space-y-4">
      {messages?.map((message) => {
        const isIncoming = message.messageType === MessageType.INCOMING;
        const isBot = message.senderType === SenderType.BOT;
        const isAgent = message.senderType === SenderType.AGENT;

        return (
          <div
            key={message.id}
            className={`flex ${isIncoming ? 'justify-start' : 'justify-end'}`}
          >
            <div
              className={`
                max-w-[70%] rounded-lg px-4 py-2 
                ${isIncoming 
                  ? 'bg-white border border-gray-200' 
                  : isBot 
                    ? 'bg-purple-100 border border-purple-200'
                    : 'bg-blue-600 text-white'
                }
              `}
            >
              {/* Badge du type d'exp√©diteur */}
              <div className="flex items-center gap-2 mb-1">
                {isBot && (
                  <span className="text-xs font-semibold text-purple-700 uppercase">
                    ü§ñ Bot
                  </span>
                )}
                {isAgent && (
                  <span className="text-xs font-semibold text-white uppercase">
                    üë§ Agent
                  </span>
                )}
                {message.senderType === SenderType.CONTACT && (
                  <span className="text-xs font-semibold text-gray-600 uppercase">
                    Contact
                  </span>
                )}
              </div>

              {/* Contenu du message */```typescript
              <p className={`text-sm ${isIncoming ? 'text-gray-900' : isBot ? 'text-gray-900' : 'text-white'}`}>
                {message.content}
              </p>

              {/* Timestamp */}
              <p className={`text-xs mt-1 ${isIncoming ? 'text-gray-500' : isBot ? 'text-gray-600' : 'text-blue-100'}`}>
                {new Date(message.createdAt).toLocaleTimeString('fr-FR', {
                  hour: '2-digit',
                  minute: '2-digit',
                })}
              </p>
            </div>
          </div>
        );
      })}
      {(!messages || messages.length === 0) && (
        <div className="flex items-center justify-center h-full">
          <p className="text-sm text-gray-500">Aucun message</p>
        </div>
      )}
      <div ref={messagesEndRef} />
    </div>
  );
}
```

---

### `frontend/components/inbox/MessageComposer.tsx`

```typescript
// frontend/components/inbox/MessageComposer.tsx

'use client';

import { useState, FormEvent } from 'react';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { apiClient } from '@/lib/apiClient';
import { Message } from '@/lib/types';

interface MessageComposerProps {
  conversationId: string;
}

export function MessageComposer({ conversationId }: MessageComposerProps) {
  const [content, setContent] = useState('');
  const queryClient = useQueryClient();

  const sendMessageMutation = useMutation({
    mutationFn: (messageContent: string) =>
      apiClient.post<Message>(`/conversations/${conversationId}/messages`, {
        content: messageContent,
      }),
    onSuccess: () => {
      // Invalider les queries pour forcer le rechargement
      queryClient.invalidateQueries({ queryKey: ['messages', conversationId] });
      queryClient.invalidateQueries({ queryKey: ['conversations', 'OPEN'] });
      setContent('');
    },
  });

  const handleSubmit = (e: FormEvent) => {
    e.preventDefault();
    if (content.trim() && !sendMessageMutation.isPending) {
      sendMessageMutation.mutate(content.trim());
    }
  };

  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {
    // Envoyer avec Ctrl+Enter ou Cmd+Enter
    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
      e.preventDefault();
      handleSubmit(e as any);
    }
  };

  return (
    <div className="border-t border-gray-200 bg-white p-4">
      <form onSubmit={handleSubmit} className="flex gap-2">
        <textarea
          value={content}
          onChange={(e) => setContent(e.target.value)}
          onKeyDown={handleKeyDown}
          placeholder="Tapez votre message... (Ctrl+Enter pour envoyer)"
          className="flex-1 resize-none border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          rows={3}
          disabled={sendMessageMutation.isPending}
        />
        <button
          type="submit"
          disabled={!content.trim() || sendMessageMutation.isPending}
          className="px-6 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors self-end"
        >
          {sendMessageMutation.isPending ? 'Envoi...' : 'Envoyer'}
        </button>
      </form>
      
      {sendMessageMutation.isError && (
        <p className="text-sm text-red-600 mt-2">
          Erreur lors de l'envoi du message
        </p>
      )}
    </div>
  );
}
```

---

## 6. Page Dashboard

### `frontend/app/dashboard/page.tsx`

```typescript
// frontend/app/dashboard/page.tsx

'use client';

import { useState } from 'react';
import { AppShell } from '@/components/layout/AppShell';
import { InboxSidebar } from '@/components/inbox/InboxSidebar';
import { ConversationList } from '@/components/inbox/ConversationList';
import { MessageList } from '@/components/inbox/MessageList';
import { MessageComposer } from '@/components/inbox/MessageComposer';

export default function DashboardPage() {
  const [selectedConversationId, setSelectedConversationId] = useState<string | undefined>();

  return (
    <AppShell sidebar={<InboxSidebar />}>
      <div className="h-full flex">
        {/* Colonne de gauche : Liste des conversations */}
        <div className="w-80 border-r border-gray-200 bg-white">
          <ConversationList
            selectedConversationId={selectedConversationId}
            onSelectConversation={setSelectedConversationId}
          />
        </div>

        {/* Colonne de droite : Messages + Composer */}
        <div className="flex-1 flex flex-col">
          {selectedConversationId ? (
            <>
              {/* Header de la conversation */}
              <div className="bg-white border-b border-gray-200 px-6 py-4">
                <h2 className="text-lg font-semibold text-gray-900">Conversation</h2>
                <p className="text-sm text-gray-500">ID: {selectedConversationId}</p>
              </div>

              {/* Liste des messages */}
              <div className="flex-1 overflow-hidden flex flex-col bg-gray-50">
                <MessageList conversationId={selectedConversationId} />
              </div>

              {/* Composer */}
              <MessageComposer conversationId={selectedConversationId} />
            </>
          ) : (
            <div className="flex-1 flex items-center justify-center bg-gray-50">
              <div className="text-center">
                <h3 className="text-lg font-medium text-gray-900 mb-2">
                  Aucune conversation s√©lectionn√©e
                </h3>
                <p className="text-sm text-gray-500">
                  S√©lectionnez une conversation dans la liste pour commencer
                </p>
              </div>
            </div>
          )}
        </div>
      </div>
    </AppShell>
  );
}
```

---

## Configuration suppl√©mentaire

### `frontend/tsconfig.json`

```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

---

### `frontend/package.json`

```json
{
  "name": "skybot-inbox-frontend",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "next": "14.2.3",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "@tanstack/react-query": "^5.28.4"
  },
  "devDependencies": {
    "typescript": "^5",
    "@types/node": "^20",
    "@types/react": "^18",
    "@types/react-dom": "^18",
    "postcss": "^8",
    "tailwindcss": "^3.4.1",
    "eslint": "^8",
    "eslint-config-next": "14.2.3"
  }
}
```

---

### `frontend/next.config.js`

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
}

module.exports = nextConfig
```

---

### `frontend/tailwind.config.ts`

```typescript
import type { Config } from "tailwindcss";

const config: Config = {
  content: [
    "./pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
};
export default config;
```

---

### `frontend/postcss.config.js`

```javascript
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

---

### `frontend/.env.local` (exemple)

```bash
NEXT_PUBLIC_API_URL=http://localhost:3000/api
```

---

## R√©sum√© de l'architecture

Voici ce que nous avons construit :

### 1. **Authentification JWT compl√®te**
   - Login/Register avec stockage du token en localStorage
   - ApiClient qui ajoute automatiquement le header Authorization
   - Gestion du 401 avec redirection automatique vers /login

### 2. **React Query pour la gestion d'√©tat**
   - Queries pour r√©cup√©rer inboxes, conversations, messages
   - Mutations pour envoyer des messages
   - Invalidation automatique des caches apr√®s envoi
   - Refetch automatique (10s pour conversations, 5s pour messages)

### 3. **Interface Inbox compl√®te**
   - **Sidebar gauche** : liste des inboxes
   - **Colonne centrale** : liste des conversations avec badges de statut et compteur unread
   - **Colonne droite** : messages + composer
   - Diff√©renciation visuelle INCOMING/OUTGOING et BOT/AGENT/CONTACT

### 4. **UX professionnelle**
   - Auto-scroll vers le dernier message
   - √âtats de chargement et d'erreur
   - Raccourci Ctrl+Enter pour envoyer
   - Design responsive avec Tailwind
   - Feedback visuel sur les actions

### Points importants :
- **Multi-tenant ready** : le token JWT contient l'accountId, le backend filtre automatiquement
- **Temps r√©el simul√©** : refetch automatique toutes les 5-10s (√† remplacer par WebSocket en production)
- **Extensible** : facile d'ajouter filtres, search, assignation, etc.

Pour d√©marrer :
```bash
cd frontend
npm install
npm run dev
```

Le frontend sera accessible sur `http://localhost:3000` et communiquera avec votre backend NestJS sur le port 3000 (API sur `/api`).